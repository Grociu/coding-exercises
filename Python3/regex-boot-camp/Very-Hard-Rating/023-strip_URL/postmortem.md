This code is ugly and complex, but I think it's readable.

It does not beat the Edabit built in test function, because of a dictionary being unindexed (order matters for output).

It beats my test function and in real world would work.

It's far from optimized though :(